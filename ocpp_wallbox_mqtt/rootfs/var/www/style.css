:root{
  --bg:#0b1220;
  --bar:#111827;
  --card:#0f172a;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --border:rgba(255,255,255,.12);
  --header-h: 64px;  
}

body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  background:var(--bg);
  color:var(--text);
}

header{
  padding:6px 10px;
  position:sticky;
  top:0;
  background:var(--bar);
  border-bottom:1px solid var(--border);
  z-index:30;
}

/* =========================
   HEADER LAYOUT (DESKTOP)
   ========================= */

/* Desktop: 1 riga, niente a capo */
header .row{
  display:flex;
  align-items:center;
  gap:10px;
  flex-wrap:nowrap;     /* IMPORTANT */
  min-width:0;
}

/* Logo fisso 40px (desktop + mobile) */
.logo{
  width:44px;
  height:44px;
  object-fit:contain;
  flex:0 0 auto;
  padding:2px;
  box-sizing:border-box;
}

.logo.charging{
  filter:drop-shadow(0 0 6px #22c55e);
  animation:pulse 1.4s infinite;
}

@keyframes pulse{
  0%{ transform:scale(1); opacity:.9; }
  50%{ transform:scale(1.06); opacity:1; }
  100%{ transform:scale(1); opacity:.9; }
}

/* Tutto il resto a destra del logo */
.right{
  display:flex;
  align-items:center;
  gap:10px;
  row-gap:4px;
  flex:1 1 auto;
  min-width:0;
  flex-wrap:nowrap;     /* IMPORTANT */
}

/* Titolo + stato */
.topline{
  display:flex;
  align-items:baseline;
  gap:8px;
  white-space:nowrap;
  flex:0 0 auto;
}

.muted{
  color:var(--muted);
  font-size:12px;
}

#status{
  display:inline-block;
  width:92px; /* abbastanza per "ok · 23:59:59" */
  text-align:left;
  font-variant-numeric:tabular-nums;
}

/* Label compatti in linea */
.right label{
  display:inline-flex;
  align-items:center;
  gap:6px;
  margin:0;
  white-space:nowrap;
  flex:0 0 auto;
}

/* Controlli */
input, select, button{
  background:var(--card);
  color:var(--text);
  border:1px solid var(--border);
  border-radius:8px;
  padding:4px 8px;
  outline:none;
}

button{ cursor:pointer; }
button:hover{ filter:brightness(1.1); }

/* Dimensioni desktop controlli */
#refresh{ width:76px; }
#filter{
  min-width:150px;
  width:190px;          /* desktop: più stabile */
}

/* Metrics a destra (non devono spaccare la riga) */
.metrics{
  margin-left:auto;
  display:flex;
  align-items:center;
  gap:10px;
  white-space:nowrap;
  min-width:0;
}

/* Pulsanti sempre insieme */
.actions{
  display:flex;
  align-items:center;
  gap:8px;
  flex:0 0 auto;
  white-space:nowrap;
}

/* nuovi wrapper */
.rightTop, .rightFull { min-width:0; }

/* Desktop: continua a comportarsi “come prima” */
.rightTop .topline{
  display:flex;
  align-items:baseline;
  gap:8px;
  white-space:nowrap;
}

.rightTop .refresh{
  margin-left:0;
  display:inline-flex;
  align-items:center;
  gap:6px;
  white-space:nowrap;
}

.rightTop .line2{
  justify-content:space-between;
  display:flex;
  gap:10px;
  align-items:center;
}


/* ===== DESKTOP: rightTop + rightFull in UNA riga ===== */
@media (min-width:601px){
  /* la riga header resta flex (già così) */
  header .row{
    display:flex;
    align-items:center;
    flex-wrap:nowrap;
  }

  /* rightTop e rightFull stanno affiancati e non vanno a capo */
  .rightTop,
  .rightFull{
    display:flex;
    align-items:center;
    gap:10px;
    flex-wrap:nowrap;
    min-width:0;
  }

  /* rightFull prende lo spazio disponibile */
  .rightFull{
    flex:1 1 auto;
  }

  /* filtro e input non devono andare a capo */
  .rightFull .wide{
    display:inline-flex;
    align-items:center;
    gap:6px;
    white-space:nowrap;
    flex:0 0 auto;
  }

  /* metrics a destra come prima */
  .footerRow{
    display:flex;
    align-items:center;
    gap:10px;
    margin-left:auto;   /* spinge metriche+azioni a destra */
    white-space:nowrap;
  }

  /* per evitare che il filtro “spinga” tutto fuori */
  #filter{ width:190px; }
}

.desktopOnly{ display:inline-flex; }

/* =========================
   HEADER LAYOUT (MOBILE)
   ========================= */
@media (max-width:600px){
  .desktopOnly{ display:none !important; }

  #filter {
    min-width: 100px;
    width: 120px;
  }
  header .row{
    display:grid;
    grid-template-columns:48px 1fr;
    column-gap:10px;
    row-gap:6px;
    align-items:start;
  }

  /* logo solo accanto al blocco top (prime 2 righe) */
  .logo{
    grid-column:1;
    grid-row:1;
    align-self:center;

  }

  .rightTop{
    grid-column:2;
    grid-row:1;
    display:grid;
    row-gap:6px;
    min-width:0;
  }

  /* titolo + status + refresh sulla stessa riga */
  .rightTop .topline{
    display:flex;
    align-items:baseline;
    gap:8px;
    white-space:nowrap;
    min-width:0;
  }

  
  /* riga 2: righe (e volendo puoi metterci altre cose) */
  .rightTop .line2{
    display:flex;
    gap:10px;
    align-items:center;
    min-width:0;
  }

  /* FULL WIDTH: parte da sinistra (sotto il logo) */
  .rightFull{
    grid-column:1 / -1;
    grid-row:2;
    display:grid;
    row-gap:6px;
    min-width:0;
  }

  .rightFull .wide{
    display:inline-flex;
    align-items:center;
    gap:6px;
    margin:0;
  }

  .rightFull .wide input{
    width:100%;
    min-width:0;
    flex:1 1 auto;
    min-width:0;
  }

  .footerRow{
    display:flex;
    align-items:center;
    gap:8px;
    min-width:0;
  }
  .rightFull .wide{
  display:flex;
  align-items:center;
  gap:8px;
}


.rightFull .wide .btnInline{
  flex:0 0 auto;
  white-space:nowrap;
  padding:6px 10px;
  font-size:13px;
}


  .footerRow .metrics{
    flex:1 1 auto;
    min-width:0;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }

  .footerRow .actions{
    flex:0 0 auto;
    white-space:nowrap;
  }
}



/* =========================
   LOG + CHART
   ========================= */

/* grafico sticky sotto l'header */
#chartWrap{
  position: sticky;
  top: var(--header-h);
  z-index: 20;

  background:#05070d;
  border-bottom:1px solid var(--border);
  padding:6px 10px;
}

#powerChart{
  display:block;
  width:100%;
  height:160px;
}
@media (max-width:480px){
  #powerChart{ height:120px; }
}

/* contenitore log */
#log{
  margin:0;
  padding:12px 14px;
  background:#000;
  color:#e6e6e6;
  min-height:calc(100vh - 56px);
  line-height:1.25;
  font-family:ui-monospace,SFMono-Regular,Menlo,monospace;
}

#line,
.line{
  white-space:pre-wrap;
  word-break:break-word;
  font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;
  font-size:13px;
  line-height:1.15;
  padding:1px 0;
}

/* =========================
   COLORI LOG
   ========================= */

.err  { color:#f87171; }
.warn { color:#fbbf24; }

.info  { color:#9ca3af; }
.dim   { color:#9ca3af; }

.state-stop  { color:#fb7185; }
.state-avail { color:#9ca3af; }
.state-chg   { color:#22c55e; }

.chgL { color:#4ade80; }
.chgH { color:#22c55e; }

.scp       { color:#f59e0b; }
.inc       { color:#4ade80; }
.dec       { color:#f87171; }
.safe      { color:#fb7185; }
.event     { color:#60a5fa; }
.gridlimit { color:#8b5cf6; }
.retain    { color:#9ca3af; }

.badge{
  margin-left:8px;
  padding:2px 8px;
  border-radius:999px;
  font-size:11px;
  font-weight:700;
  letter-spacing:.3px;
  border:1px solid rgba(34,197,94,.35);
  background: rgba(34,197,94,.12);
  color:#22c55e;
  white-space:nowrap;
}
.badge.warn{
  border-color: rgba(251,113,133,.35);
  background: rgba(251,113,133,.10);
  color:#fb7185;
}


#spark{
  border:1px solid rgba(255,255,255,.10);
  border-radius:6px;
  background:rgba(255,255,255,.03);
}
